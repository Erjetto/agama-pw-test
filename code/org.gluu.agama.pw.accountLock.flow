Flow org.gluu.agama.pw.accountLock
     Basepath ""
     Timeout 500 seconds
     Configs conf
Log "@info Start execution of the account lock  flow."
// Create json variable for feedback
uiFeedback = {}
// Get an instance of PasswordService Class
validationService = Call org.gluu.agama.pw.PasswordService#getInstance conf
// Iterate x times max
Repeat 3 times max
     // Retrieve user credentials from UI
     credentials = RRF "login-basic.ftlh" uiFeedback
     // Log the successfull  used credentials retrieval.
     Log "@info User credentials collected successfully!"
     // Validate provided user credentials
     uiFeedback.succeed = Call validationService validate credentials.username credentials.password
     Log "@info Validation done"
     // If user credentials is valid
     When uiFeedback.succeed is true
          // Valid credentials provided
          Log "@info Credentials is valid"
          // Unlock user account
          unlockResult = Call validationService unlock credentials.username
          // Password validation completed successfully!
          it_fxfqe = {success:true, data: { userId: credentials.username }}
          Finish it_fxfqe
     Log "@info Invalid credentials provided."
     // Lock user account if needed
     lockResult = Call validationService lock credentials.username
     When lockResult is true
          Log "@info User account locked"
          // Provide account lock feedback
          uiFeedback.errorMessage = "Your account has been locked. Try again in few minutes."
     Log "@error Fail login attempt"
     uiFeedback.errorMessage = "Invalid credentails.Try again!"
Log "@info Log failed login after max attempts"
it_jalju = {success:false, error: "Password validation failed!"}
Finish it_jalju